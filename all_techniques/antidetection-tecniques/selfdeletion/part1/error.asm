.code

getTEB proc
    mov rax, qword ptr gs:[30h]  ; self-referencing to TEB
    ret
getTEB endp

CustomError proc
    xor eax, eax
    call getTEB
    mov eax, dword ptr [rax+68h] ; LastErrorValue
    ret
CustomError endp

end

;To create a .obj from .asm
;   ml64 /c /Fo"name.obj" name.asm